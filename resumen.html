<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>House Burger - Bienvenido</title>
       <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+YffS3ZT+JdbD9lM9OquDTMCp+oj+7zK1WEnKbV1JlF99k0yEhe7r9GqQXOxkOsl" crossorigin="anonymous">
<link href="css/style.css" rel="stylesheet">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">


<!-- Bootstrap Bundle con Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<style>
    .list-group{
        padding: 5px;;
    }

    
    .page-footer {
        position: fixed;     /* se queda fijo */
        bottom: 0;           /* pegado al fondo */
        left: 0;
        width: 100%;         /* ocupa todo el ancho */
        background: #f8f9fa; /* color de fondo tipo Bootstrap */
        padding: 10px 0;
        box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
        z-index: 999;        /* encima de otros elementos */
    }

    .bg-info{
        font-size: 15px!important;
        font-weight: 500;
    }

</style>

 
</head>
<body>

   


<header style="
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
">

<!-- Bot√≥n flotando a la derecha -->
    <button id="btnCarrito"
        style=" font-size: 25px; border: none; background: transparent;">
        üè† <!-- üëà puedes cambiarlo por  -->
    </button>
    <!-- Logo centrado dentro del header -->
    <div style="flex: 1; text-align: center;">
        <img src="images/logo2.png" width="70">
        <p style="display:none">¬°Extremadamente deliciosas. Pruebalas!</p>
    </div>
    <!-- Bot√≥n flotando a la derecha -->
    <button id="btnOrdenesModal" onclick="verModalOrdenes()" 
        style=" font-size: 25px; border: none; background: transparent;">
        ‚û°Ô∏è <!-- üëà puedes cambiarlo por  -->
    </button>
</header>


            <div class="modal-header" style="padding: 10px;">
        
                <h5 class="modal-title" id="lblCantidadOrden">üìù 0 </h5>
                <input type="date" name="" id="txtFecha">
            </div>
       <center> <span id="lblUbicacion"></span></center>
            <div class="modal-body" id="resumenVentas">
            
            </div>
   


 

<footer class="page-footer">
    
    <center>
        <button id="btnTransfer" type="button" style="width: 100px; font-weight: 700;" class="btn btn-info">Transfer<br>$100</button>
        &nbsp;
        <button id="btnEfectivo" type="button" style="width: 100px; font-weight: 700;" class="btn btn-danger">Efectivo<br>$100</button>
        &nbsp;
        <button id="btnTotal" type="button" style="width: 100px; font-weight: 700;" class="btn btn-success">Total<br>$200</button>
    </center>
</footer>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

function verOrdenes() {
    var fecha = document.getElementById("txtFecha").value;
            $.ajax({
                type: "GET",
                url: "https://amahcarev2.somee.com/apihouse.ashx?Comando=ConsultarVentasPorFecha&Fecha=" + fecha,
                contentType: false,
                processData: false,
                dataType: "json", // asegura que jQuery lo trate como JSON
                success: function (result) {
                    if (JSON.stringify(result) != '[]') {
                    let data = typeof result === 'string' ? JSON.parse(result) : result;
                    let contenedor = $('#resumenVentas');
                    contenedor.empty();
                    let pedidos = {};
                    data.forEach(item => {
                        if (!pedidos[item.idorden]) pedidos[item.idorden] = [];
                        pedidos[item.idorden].push(item);
                    });
                    for (let idorden in pedidos) {
                        let items = pedidos[idorden];
                        let ul = $('<ul class="list-group mb-3"></ul>');
                        items.forEach(item => {
                            let li = $('<li class="list-group-item" ></li>');
                            let header = $('<div class="d-flex justify-content-between align-items-center"></div>');
                            // separar productos por coma
                            let productos = item.productos.split(",");
                            var productoscad = "";
                            var preciocad = "";
                            productos.forEach(prod => {
                                // quitar espacios extra
                                let p = prod.trim();
                                p = p.split('|');
                                productoscad = productoscad + `${p[0]}<br>`;
                                preciocad = preciocad + `<b>$${p[1]}</span><b><br>`
                            });
                            li.append($(`<div><span class="badge bg-info rounded-pill">${item.idorden}</span>${item.ubicacion}</div>`));
                            header.append($(`<div>${productoscad}</div>`));
                            header.append($(`<div>${preciocad}</div>`));                          
                            li.append(header);
                            li.append($(`                         
                                <table style="width: 100%; margin: 0 auto; color: black; text-align: center;">
                                    <tr>
                                        <td style="text-align: left; font-weight: 500;">Paga: ${item.pagacon}</td>
                                        <td style="text-align: center; font-weight: 500;">Cambio: ${item.cambio}</td>
                                        <td style="text-align: right; font-weight: 700;">Total: $${item.total}</td>
                                    </tr>
                                </table>
                            `));
                            ul.append(li);
                        });
                        contenedor.append(ul);
                    }
                } else {
                        console.log("Imagen");
                        document.getElementById("resumenVentas").innerHTML = `
                        <br><br><br>
                            <center><p>No hay ventas</p>
                            <img src="images/completadas.webp" style="opacity:0.3" width="50%" class="img-fluid"><center
                        `;
                }
                },
                error: function (jqXmlHttpRequest, textStatus, errorThrown) {
                    setTimeout(function () { $("#loading").hide(); }, 1000);
                    console.log("Error: "+errorThrown);
                }
            });
        }

        // Ejecutar cada 5 segundos
$(document).ready(function() {
    let hoy = new Date();
    let yyyy = hoy.getFullYear();
    let mm = String(hoy.getMonth() + 1).padStart(2, '0'); // meses 0-11
    let dd = String(hoy.getDate()).padStart(2, '0');
    let fechaHoy = `${yyyy}-${mm}-${dd}`;
    $("#txtFecha").val(fechaHoy);
     // --- Ejecutar verOrdenes() cuando cambie ---
    $("#txtFecha").on("change", function () {
        verOrdenes();
        verResumen();
    });
    verOrdenes();
    verResumen();
});


function verResumen() {
    var fecha = document.getElementById("txtFecha").value;
            $.ajax({
                type: "GET",
                url: "https://amahcarev2.somee.com/apihouse.ashx?Comando=ConsultarResumenPorFecha&Fecha=" + fecha,
                contentType: false,
                processData: false,
                dataType: "json", // asegura que jQuery lo trate como JSON
                success: function (result) {
                
                    document.getElementById("lblCantidadOrden").innerHTML =  `üìù #${result[0].NumeroOrdenes}`;
                    document.getElementById("btnTransfer").innerHTML =  `Transfer<br>$${result[0].TotalTransferencia}`;
                    document.getElementById("btnEfectivo").innerHTML =  `Efectivo<br>$${result[0].TotalEfectivo}`;
                    document.getElementById("btnTotal").innerHTML =  `Total<br>$${result[0].TotalGeneral}`;
            
                },
                error: function (jqXmlHttpRequest, textStatus, errorThrown) {
                    setTimeout(function () { $("#loading").hide(); }, 1000);
                    console.log("Error: "+errorThrown);
                }
            });
        }

       

    </script>
</body>
</html>
